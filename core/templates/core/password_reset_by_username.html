{% extends "core/base_public.html" %}
{% block subtitle %}Réinitialisez votre mot de passe{% endblock %}
{% block content %}
<div>
  <h2 style="text-align:center;">Réinitialisation du mot de passe</h2>
  {% if error_message %}
    <div class="alert alert-danger" style="color:#c00; text-align:center;">{{ error_message }}</div>
  {% endif %}
  <form method="post">
    {% csrf_token %}
    {% if not code_sent and not show_password_form %}
      <div class="form-group">
        <label for="id_username">Nom d'utilisateur</label>
        <input type="text" name="username" id="id_username" class="form-control" value="{{ username }}" required>
      </div>
      {% if email_found %}
        <div class="form-group mt-3">
          <label>Adresse email associée</label>
          <input type="text" class="form-control" value="{{ masked_email }}" readonly>
        </div>
        <button type="submit" name="send_code" class="btn btn-primary mt-3">Réinitialiser le mot de passe</button>
      {% else %}
        <button type="submit" class="btn btn-primary mt-3">Valider</button>
      {% endif %}
    {% elif code_sent and not show_password_form %}
      <div class="form-group">
        <label>Un code de vérification a été envoyé à l'adresse :</label>
        <input type="text" class="form-control" value="{{ masked_email }}" readonly>
      </div>
      <div class="form-group mt-3">
        <label for="id_code">Entrez le code reçu par email</label>
        <input type="text" name="code" id="id_code" class="form-control" required>
      </div>
      <button type="submit" name="verify_code" class="btn btn-primary mt-3">Soumettre</button>
    {% elif show_password_form %}
      <div class="form-group">
        <label for="id_password1">Nouveau mot de passe</label>
        <input type="password" name="password1" id="id_password1" class="form-control" required>
      </div>
      <div class="form-group mt-3">
        <label for="id_password2">Confirmer le nouveau mot de passe</label>
        <input type="password" name="password2" id="id_password2" class="form-control" required>
      </div>
      <button type="submit" name="set_password" class="btn btn-primary mt-3">Changer le mot de passe</button>
    {% endif %}
  </form>
  <a href="{% url 'connexion' %}" class="d-block mt-3">Retour à la connexion</a>
</div>
{% endblock %} 