{% extends 'core/base.html' %}
{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2>{% if rapport %}Modifier{% else %}Créer{% endif %} le rapport d'intervention</h2>
            <p class="text-muted">Intervention : {{ intervention.titre }}</p>

            <a href="javascript:history.back()" class="btn btn-outline-secondary mb-3">
              <i class="fas fa-arrow-left"></i> Retour
            </a>

            <form method="post" enctype="multipart/form-data" class="mt-4">
                {% csrf_token %}
                
                <!-- 1. En-tête administratif (infos automatiques) -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>1. En-tête administratif</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <p><strong>Numéro d'intervention :</strong> {{ intervention.id }}</p>
                                <p><strong>Mission :</strong> {{ intervention.mission.titre }}</p>
                                <p><strong>Client :</strong> {{ intervention.mission.client.nom }}</p>
                            </div>
                            <div class="col-md-4">
                                <p><strong>Intervenant :</strong> {{ intervention.intervenant }}</p>
                                <p><strong>Date et heure de début :</strong> 
                                  {% if intervention.heure_arrivee %}
                                    {{ intervention.date|date:'d/m/Y' }} {{ intervention.heure_arrivee|time:'H:i' }}
                                  {% else %}-{% endif %}
                                </p>
                                <p><strong>Date et heure de fin :</strong> 
                                  {% if intervention.heure_depart %}
                                    {{ intervention.date|date:'d/m/Y' }} {{ intervention.heure_depart|time:'H:i' }}
                                  {% else %}-{% endif %}
                                </p>
                            </div>
                            <div class="col-md-4">
                                <p><strong>Lieu :</strong> {{ intervention.lieu }}</p>
                                <p><strong>Date intervention :</strong> {{ intervention.date|date:'d/m/Y' }}</p>
                                <p><strong>Durée de travail :</strong> 
                                  {% if intervention.heure_arrivee and intervention.heure_depart %}
                                    Calculé automatiquement lors de la sauvegarde
                                  {% else %}
                                    Non renseigné
                                  {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!--2ulement et actions réalisées -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>2. Déroulement et actions réalisées</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Travaux réalisés *</label>
                            {{ form.travaux_realises }}
                        </div>
                        <div class="form-group mt-3">
                            <label>Résultat final *</label>
                            {{ form.resultat_final }}
                        </div>
                        <div class="form-group mt-3">
                            <label>Ressources utilisées *</label>
                            {{ form.ressources_utilisees }}
                        </div>
                        <div class="form-group mt-3">
                            <label>Améliorations à faire</label>
                            {{ form.ameliorations_a_faire }}
                        </div>
                    </div>
                </div>

                <!-- 3. Preuves -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>3. Preuves</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Ajouter des fichiers/photos</label>
                            <input type="file" name="preuves" multiple class="form-control" accept="image/*,.pdf,.doc,.docx">
                            <small class="form-text text-muted">Vous pouvez sélectionner plusieurs fichiers (photos, documents, etc.)</small>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between">
                    <a href="{% url 'rapport_intervention' intervention.id %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Retour
                    </a>
                    <div>
                        <button type="submit" name="action" value="brouillon" class="btn btn-warning mr-2">
                            <i class="fas fa-save"></i> Annuler (Brouillon)
                        </button>
                        <button type="submit" name="action" value="soumettre" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Soumettre
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.form-group {
    margin-bottom: 1rem;
}
.form-group label {
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
    display: block;
}
.form-control {
    border: 1px solid #ddd;
    border-radius: 0.375rem;
    padding: 0.5rem 0.75rem;
}
.form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}
.card-header h4 {
    margin: 0;
    color: #333;
    font-weight: 600;
}
</style>
{% endblock %} 